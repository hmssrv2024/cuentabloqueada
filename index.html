<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no" />
  <title>Cuenta Bloqueada - Remeex Visa</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    /* === VARIABLES Y RESET === */
    :root {
      /* Colores principales */
      --visa-blue: #142787;
      --visa-dark-blue: #1A1F71;
      --visa-gold: #F7B600;
      --visa-light: #ffffff;
      --visa-gray: rgba(255,255,255,0.78);

      /* Sistema de color */
      --primary: var(--visa-blue);
      --primary-dark: var(--visa-dark-blue);
      --accent: var(--visa-gold);
      --text: var(--visa-light);
      --text-muted: var(--visa-gray);
      --bg: #0d102d;
      --surface: rgba(20, 39, 135, 0.65);
      --border: rgba(247, 182, 0, 0.3);
      --shadow: 0 8px 24px rgba(20,39,135,0.35);

      /* Tipograf√≠a m√≥vil optimizada */
      --fs-xs: 11px;
      --fs-sm: 13px;
      --fs-md: 15px;
      --fs-lg: 17px;
      --fs-xl: 19px;
      --fs-2xl: 22px;
      
      /* Espaciado optimizado para m√≥vil */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 12px;
      --space-lg: 16px;
      --space-xl: 20px;
      --space-2xl: 24px;

      /* Bordes */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;

      /* Layout m√≥vil */
      --mobile-padding: 16px;
      --mobile-gap: 12px;
      --mobile-btn-height: 44px;
      --mobile-input-height: 42px;

      /* Viewport espec√≠fico */
      --vh: 1vh;
      --vw: 1vw;
    }

    /* Reset moderno */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: var(--fs-md);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      position: relative;
      overflow-y: auto;
      overscroll-behavior: contain;
    }

    /* === LAYOUT PRINCIPAL M√ìVIL === */
    .mobile-container {
      position: relative;
      min-height: 100vh;
      min-height: calc(var(--vh, 1vh) * 100);
      display: flex;
      flex-direction: column;
      background: radial-gradient(circle at top right, rgba(20,39,135,0.4) 0%, transparent 60%),
                  radial-gradient(circle at bottom left, rgba(247,182,0,0.2) 0%, transparent 50%),
                  var(--bg);
      padding: env(safe-area-inset-top, 0) env(safe-area-inset-right, var(--mobile-padding)) 
               env(safe-area-inset-bottom, var(--mobile-padding)) env(safe-area-inset-left, var(--mobile-padding));
    }

    /* Header compacto */
    .mobile-header {
      flex-shrink: 0;
      padding: var(--space-md) 0;
      text-align: center;
    }

    .logo {
      max-width: 140px;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    /* Contenido principal */
    .mobile-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 400px;
      margin: 0 auto;
      width: 100%;
      padding: 0 var(--space-sm);
    }

    /* === TARJETA PRINCIPAL === */
    .main-card {
      background: linear-gradient(160deg, rgba(26,31,113,0.8), rgba(20,39,135,0.6));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: var(--space-xl);
      box-shadow: var(--shadow);
      margin: var(--space-md) 0;
      position: relative;
      overflow: hidden;
    }

    .main-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(45deg, var(--accent), var(--primary), var(--accent));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.6;
      animation: shimmer 3s linear infinite;
    }

    @keyframes shimmer {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Badge de alerta */
    .alert-badge {
      display: inline-block;
      background: rgba(247,182,0,0.15);
      color: var(--accent);
      padding: var(--space-xs) var(--space-md);
      border-radius: 20px;
      font-size: var(--fs-xs);
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      border: 1px solid rgba(247,182,0,0.3);
      margin-bottom: var(--space-md);
    }

    /* T√≠tulo */
    .main-title {
      font-size: var(--fs-xl);
      font-weight: 800;
      color: var(--accent);
      text-align: center;
      margin-bottom: var(--space-lg);
      line-height: 1.3;
    }

    /* Descripci√≥n */
    .main-description {
      font-size: var(--fs-md);
      color: var(--text-muted);
      text-align: center;
      line-height: 1.4;
      margin-bottom: var(--space-xl);
    }

    /* === SALDOS OPTIMIZADOS === */
    .balance-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-sm);
      background: rgba(0,0,0,0.3);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin-bottom: var(--space-xl);
      border: 1px solid rgba(247,182,0,0.2);
    }

    .balance-item {
      text-align: center;
    }

    .balance-label {
      font-size: var(--fs-xs);
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: var(--space-xs);
    }

    .balance-value {
      font-size: var(--fs-lg);
      font-weight: 700;
      color: var(--text);
    }

    /* === BOTONES M√ìVILES OPTIMIZADOS === */
    .button-stack {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      margin-top: auto;
      padding-top: var(--space-lg);
    }

    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      height: var(--mobile-btn-height);
      padding: 0 var(--space-lg);
      border-radius: var(--radius-md);
      font-size: var(--fs-md);
      font-weight: 600;
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn:disabled {
      opacity: 0.5;
      pointer-events: none;
    }

    .btn--primary {
      background: linear-gradient(135deg, #25D366, #128C7E);
      color: white;
      box-shadow: 0 4px 12px rgba(37,211,102,0.3);
    }

    .btn--secondary {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      box-shadow: 0 4px 12px rgba(20,39,135,0.3);
    }

    .btn--danger {
      background: linear-gradient(135deg, #ff5f6d, #d71b3b);
      color: white;
      box-shadow: 0 4px 12px rgba(255,95,109,0.3);
    }

    .btn--ghost {
      background: rgba(255,255,255,0.1);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.2);
    }

    /* === ESTADOS DE ESPERA === */
    .waiting-state {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: var(--space-lg);
      text-align: center;
      padding: var(--space-xl) var(--space-md);
    }

    .waiting-state.is-active {
      display: flex;
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .waiting-text {
      font-size: var(--fs-md);
      color: var(--text-muted);
      line-height: 1.4;
    }

    .waiting-warning {
      font-size: var(--fs-sm);
      color: rgba(255,255,255,0.6);
      background: rgba(215,27,59,0.15);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      border: 1px solid rgba(215,27,59,0.3);
    }

    /* === SISTEMA DE OVERLAY M√ìVIL === */
    .overlay {
      position: fixed;
      inset: 0;
      z-index: 1000;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .overlay.is-visible {
      display: flex;
      opacity: 1;
    }

    .overlay-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, rgba(26,31,113,0.95), rgba(20,39,135,0.90));
      overflow: hidden;
    }

    /* Header del overlay */
    .overlay-header {
      flex-shrink: 0;
      padding: calc(env(safe-area-inset-top, 0px) + var(--space-lg)) var(--mobile-padding) var(--space-lg);
      background: rgba(26,31,113,0.9);
      border-bottom: 1px solid rgba(247,182,0,0.2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .overlay-title {
      font-size: var(--fs-xl);
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      margin-bottom: var(--space-sm);
    }

    .overlay-subtitle {
      font-size: var(--fs-sm);
      color: var(--text-muted);
      text-align: center;
    }

    .overlay-close {
      position: absolute;
      top: calc(env(safe-area-inset-top, 0px) + var(--space-lg));
      right: var(--mobile-padding);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: white;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* Contenido del overlay */
    .overlay-content {
      flex: 1;
      overflow-y: auto;
      padding: 0 var(--mobile-padding) calc(env(safe-area-inset-bottom, 0px) + var(--space-lg));
      -webkit-overflow-scrolling: touch;
      scroll-padding-top: var(--space-lg);
    }

    /* === SISTEMA WIZARD M√ìVIL === */
    .wizard-progress {
      display: flex;
      gap: var(--space-xs);
      margin: var(--space-lg) 0;
      padding: 0 var(--space-sm);
    }

    .progress-step {
      flex: 1;
      height: 4px;
      background: rgba(255,255,255,0.15);
      border-radius: 2px;
      overflow: hidden;
      transition: background 0.3s ease;
    }

    .progress-step.is-active,
    .progress-step.is-completed {
      background: linear-gradient(90deg, var(--accent), #ffd36b);
    }

    .wizard-step {
      display: none;
      padding: var(--space-lg) 0;
    }

    .wizard-step.is-active {
      display: block;
    }

    /* === FORMULARIOS M√ìVILES === */
    .form-grid {
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }

    .form-row {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .form-label {
      font-size: var(--fs-sm);
      color: var(--text-muted);
      font-weight: 500;
    }

    .form-input {
      height: var(--mobile-input-height);
      padding: 0 var(--space-md);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: var(--radius-md);
      background: rgba(0,0,0,0.2);
      color: var(--text);
      font-size: var(--fs-md);
      transition: border-color 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(247,182,0,0.2);
    }

    .form-input::placeholder {
      color: rgba(255,255,255,0.4);
    }

    .form-textarea {
      min-height: 80px;
      padding: var(--space-md);
      resize: vertical;
    }

    /* Opciones de radio m√≥viles */
    .options-grid {
      display: grid;
      gap: var(--space-sm);
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius-md);
      background: rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .option-item:active {
      transform: scale(0.98);
    }

    .option-item:has(input:checked) {
      border-color: var(--accent);
      background: rgba(247,182,0,0.1);
    }

    .option-radio {
      appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      position: relative;
      cursor: pointer;
    }

    .option-radio:checked {
      border-color: var(--accent);
    }

    .option-radio:checked::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    .option-label {
      font-size: var(--fs-md);
      color: var(--text);
      cursor: pointer;
      flex: 1;
    }

    /* === NAVEGACI√ìN WIZARD === */
    .wizard-navigation {
      display: flex;
      gap: var(--space-md);
      padding-top: var(--space-xl);
      border-top: 1px solid rgba(255,255,255,0.1);
      margin-top: var(--space-xl);
    }

    .nav-btn {
      flex: 1;
      height: var(--mobile-btn-height);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--fs-md);
      font-weight: 600;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .nav-btn--back {
      background: rgba(255,255,255,0.1);
      color: var(--text-muted);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .nav-btn--next {
      background: linear-gradient(135deg, #25D366, #128C7E);
      color: white;
    }

    .nav-btn:disabled {
      opacity: 0.4;
      pointer-events: none;
    }

    /* === PREVIEW DEL MENSAJE === */
    .message-preview {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      font-size: var(--fs-sm);
      color: var(--text-muted);
      white-space: pre-wrap;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* === FIRMA DIGITAL M√ìVIL === */
    .signature-overlay .overlay-container {
      background: linear-gradient(180deg, rgba(13,16,45,0.98), rgba(20,39,135,0.95));
    }

    .signature-guidance {
      padding: var(--space-lg);
      background: rgba(26,31,113,0.5);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-lg);
    }

    .signature-guidance h3 {
      color: var(--accent);
      font-size: var(--fs-lg);
      margin-bottom: var(--space-md);
    }

    .signature-guidance p {
      color: var(--text-muted);
      font-size: var(--fs-sm);
      line-height: 1.4;
      margin-bottom: var(--space-md);
    }

    .signature-pad-container {
      background: linear-gradient(160deg, rgba(4,12,48,0.9), rgba(15,28,76,0.8));
      border: 2px solid rgba(247,182,0,0.3);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      margin-bottom: var(--space-lg);
      position: relative;
      overflow: hidden;
    }

    .signature-canvas-wrapper {
      position: relative;
      height: 200px;
      border-radius: var(--radius-md);
      overflow: hidden;
      background: rgba(0,0,0,0.4);
    }

    #signaturePad {
      width: 100%;
      height: 100%;
      display: block;
      cursor: crosshair;
      touch-action: none;
    }

    .signature-guidelines {
      position: absolute;
      inset: var(--space-lg);
      pointer-events: none;
    }

    .signature-line {
      position: absolute;
      left: 0;
      right: 0;
      height: 1px;
      background: rgba(255,255,255,0.1);
      border-top: 1px dashed rgba(247,182,0,0.3);
    }

    .signature-line--main {
      bottom: 30%;
      opacity: 0.8;
    }

    .signature-line--top {
      top: 25%;
      opacity: 0.4;
    }

    .signature-line--bottom {
      bottom: 15%;
      opacity: 0.6;
    }

    .signature-hint {
      text-align: center;
      font-size: var(--fs-sm);
      color: rgba(255,255,255,0.6);
      margin-top: var(--space-md);
      padding: 0 var(--space-md);
    }

    .signature-controls {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .signature-tools {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-sm);
    }

    .signature-tools .btn {
      font-size: var(--fs-sm);
      height: 36px;
    }

    .signature-status {
      text-align: center;
      font-size: var(--fs-sm);
      color: var(--text-muted);
      padding: var(--space-md);
      min-height: 2em;
    }

    .signature-status--success {
      color: #4ade80;
    }

    .signature-status--warning {
      color: #fbbf24;
    }

    .signature-status--error {
      color: #f87171;
    }

    /* === MODAL DE AN√ÅLISIS === */
    .analysis-modal {
      position: fixed;
      inset: 0;
      z-index: 1100;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: var(--mobile-padding);
    }

    .analysis-modal.is-visible {
      display: flex;
    }

    .analysis-content {
      background: linear-gradient(180deg, rgba(26,31,113,0.95), rgba(20,39,135,0.90));
      border: 1px solid rgba(247,182,0,0.4);
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      text-align: center;
      max-width: 350px;
      width: 100%;
      position: relative;
    }

    .analysis-spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto var(--space-lg);
    }

    .analysis-title {
      font-size: var(--fs-lg);
      color: var(--text);
      margin-bottom: var(--space-md);
    }

    .analysis-detail {
      font-size: var(--fs-sm);
      color: var(--text-muted);
      line-height: 1.4;
      margin-bottom: var(--space-lg);
    }

    .analysis-progress {
      background: rgba(255,255,255,0.1);
      height: 6px;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: var(--space-md);
    }

    .analysis-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--primary));
      width: 0%;
      transition: width 0.5s ease;
    }

    .analysis-percentage {
      font-size: var(--fs-sm);
      color: var(--accent);
      font-weight: 600;
    }

    /* === MODAL DE ELIMINACI√ìN === */
    .deletion-modal .overlay-container {
      justify-content: center;
      align-items: center;
      padding: var(--mobile-padding);
    }

    .deletion-content {
      background: linear-gradient(160deg, rgba(26,31,113,0.95), rgba(20,39,135,0.90));
      border: 1px solid rgba(247,182,0,0.3);
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      max-width: 380px;
      width: 100%;
    }

    .deletion-title {
      font-size: var(--fs-xl);
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      margin-bottom: var(--space-lg);
    }

    .deletion-text {
      font-size: var(--fs-md);
      color: var(--text-muted);
      line-height: 1.5;
      margin-bottom: var(--space-lg);
    }

    .deletion-warning {
      background: rgba(220,38,38,0.15);
      border: 1px solid rgba(220,38,38,0.3);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      color: #fecaca;
      font-size: var(--fs-sm);
      margin-bottom: var(--space-lg);
    }

    .deletion-actions {
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    /* === NOTIFICACI√ìN SUSPENSI√ìN === */
    .suspension-notice {
      position: fixed;
      inset: 0;
      z-index: 1200;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      padding: var(--mobile-padding);
    }

    .suspension-notice.is-visible {
      display: flex;
    }

    .suspension-content {
      background: linear-gradient(160deg, rgba(26,31,113,0.95), rgba(20,39,135,0.90));
      border: 1px solid rgba(247,182,0,0.4);
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      max-width: 360px;
      width: 100%;
      text-align: center;
    }

    .suspension-icon {
      width: 48px;
      height: 48px;
      background: rgba(247,182,0,0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-lg);
      font-size: 24px;
      color: var(--accent);
    }

    .suspension-title {
      font-size: var(--fs-xl);
      font-weight: 700;
      color: var(--accent);
      margin-bottom: var(--space-md);
    }

    .suspension-message {
      font-size: var(--fs-md);
      color: var(--text-muted);
      line-height: 1.4;
      margin-bottom: var(--space-xl);
    }

    .suspension-actions {
      display: flex;
      gap: var(--space-md);
    }

    /* === LOADING GLOBAL === */
    .global-loader {
      position: fixed;
      inset: 0;
      z-index: 2000;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.9);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    .global-loader.is-visible {
      display: flex;
    }

    .loader-content {
      text-align: center;
      color: var(--text);
    }

    .loader-spinner {
      width: 48px;
      height: 48px;
      margin: 0 auto var(--space-lg);
    }

    .loader-message {
      font-size: var(--fs-lg);
      font-weight: 600;
      margin-bottom: var(--space-sm);
    }

    .loader-subtitle {
      font-size: var(--fs-sm);
      color: var(--text-muted);
    }

    /* === ESTADOS ESPECIALES === */
    .is-waiting .main-description,
    .is-waiting .button-stack {
      display: none;
    }

    .is-waiting .waiting-state {
      display: flex;
    }

    .is-deleting .main-description {
      color: rgba(255,255,255,0.6);
    }

    .is-deleting .button-stack {
      opacity: 0.3;
      pointer-events: none;
    }

    /* === UTILIDADES === */
    .hidden {
      display: none !important;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .text-center {
      text-align: center;
    }

    .text-muted {
      color: var(--text-muted);
    }

    .font-bold {
      font-weight: 700;
    }

    /* === ANIMACIONES ADICIONALES === */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }

    .slide-up {
      animation: slideUp 0.4s ease;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* === MEDIA QUERIES PROGRESIVAS === */
    
    /* Tel√©fonos muy peque√±os (hasta 320px) */
    @media (max-width: 320px) {
      :root {
        --mobile-padding: 12px;
        --space-lg: 12px;
        --space-xl: 16px;
        --fs-md: 14px;
        --fs-lg: 16px;
        --fs-xl: 18px;
      }
      
      .main-card {
        padding: var(--space-lg);
      }
      
      .balance-container {
        grid-template-columns: 1fr;
        gap: var(--space-md);
      }
      
      .signature-canvas-wrapper {
        height: 160px;
      }
    }

    /* Tel√©fonos peque√±os (321px - 375px) */
    @media (min-width: 321px) and (max-width: 375px) {
      .balance-container {
        padding: var(--space-md);
      }
      
      .signature-canvas-wrapper {
        height: 180px;
      }
    }

    /* Tel√©fonos medianos (376px - 414px) */
    @media (min-width: 376px) and (max-width: 414px) {
      :root {
        --fs-md: 15px;
        --fs-lg: 17px;
        --fs-xl: 20px;
      }
      
      .signature-canvas-wrapper {
        height: 200px;
      }
    }

    /* Tel√©fonos grandes (415px - 480px) */
    @media (min-width: 415px) and (max-width: 480px) {
      :root {
        --mobile-padding: 20px;
        --fs-md: 16px;
        --fs-lg: 18px;
        --fs-xl: 22px;
      }
      
      .mobile-content {
        max-width: 420px;
      }
      
      .signature-canvas-wrapper {
        height: 220px;
      }
      
      .signature-tools {
        grid-template-columns: 1fr 1fr 1fr;
      }
    }

    /* Tablets peque√±as en vertical (481px - 768px) */
    @media (min-width: 481px) and (max-width: 768px) {
      :root {
        --mobile-padding: 24px;
        --space-xl: 24px;
        --space-2xl: 32px;
        --fs-md: 16px;
        --fs-lg: 19px;
        --fs-xl: 24px;
        --fs-2xl: 26px;
      }
      
      .mobile-content {
        max-width: 480px;
      }
      
      .main-card {
        padding: var(--space-2xl);
      }
      
      .form-row {
        flex-direction: row;
        gap: var(--space-lg);
      }
      
      .form-group {
        flex: 1;
      }
      
      .options-grid {
        grid-template-columns: 1fr 1fr;
      }
      
      .signature-canvas-wrapper {
        height: 280px;
      }
      
      .wizard-navigation {
        flex-direction: row;
      }
      
      .nav-btn {
        flex: 0 0 auto;
        min-width: 120px;
      }
    }

    /* Landscape en m√≥viles */
    @media (orientation: landscape) and (max-height: 480px) {
      .mobile-container {
        padding-top: var(--space-sm);
        padding-bottom: var(--space-sm);
      }
      
      .mobile-header {
        padding: var(--space-sm) 0;
      }
      
      .logo {
        max-width: 120px;
      }
      
      .main-card {
        margin: var(--space-sm) 0;
        padding: var(--space-lg);
      }
      
      .signature-canvas-wrapper {
        height: 140px;
      }
      
      .overlay-header {
        padding-top: calc(env(safe-area-inset-top, 0px) + var(--space-md));
        padding-bottom: var(--space-md);
      }
    }

    /* Soporte para dispositivos con notch */
    @supports (padding: max(0px)) {
      .mobile-container {
        padding-left: max(var(--mobile-padding), env(safe-area-inset-left));
        padding-right: max(var(--mobile-padding), env(safe-area-inset-right));
      }
    }

    /* Reducir animaciones si es solicitado */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      
      .shimmer {
        animation: none;
      }
    }

    /* Tema oscuro mejorado */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0a0d1f;
        --surface: rgba(20, 39, 135, 0.7);
      }
    }
  </style>
</head>
<body>
  <!-- Contenedor principal m√≥vil -->
  <div class="mobile-container">
    
    <!-- Header -->
    <header class="mobile-header">
      <img class="logo" src="remeexvisa2025_blanco.png" alt="Remeex Visa" />
    </header>

    <!-- Contenido principal -->
    <main class="mobile-content">
      <div class="main-card">
        
        <!-- Badge de alerta -->
        <div class="alert-badge">Alerta de seguridad</div>
        
        <!-- T√≠tulo -->
        <h1 class="main-title">Cuenta Bloqueada Temporalmente</h1>
        
        <!-- Saldos -->
        <div class="balance-container" aria-live="polite">
          <div class="balance-item">
            <div class="balance-label">Saldo Bs.</div>
            <div id="saldoBs" class="balance-value">Bs. 0,00</div>
          </div>
          <div class="balance-item">
            <div class="balance-label">Saldo USD</div>
            <div id="saldoUsd" class="balance-value">$0.00</div>
          </div>
        </div>
        
        <!-- Descripci√≥n -->
        <p id="mainDescription" class="main-description">
          Su cuenta ha sido suspendida por motivos de seguridad. Para resolver este inconveniente y reactivar su cuenta, debe comunicarse inmediatamente con nuestro equipo de soporte t√©cnico.
        </p>
        
        <!-- Estado de espera -->
        <div id="waitingState" class="waiting-state" aria-live="assertive">
          <div class="spinner" aria-hidden="true"></div>
          <p class="waiting-text">
            Esperamos que <strong id="waitingUser">el titular</strong> subsane la informaci√≥n solicitada. Mientras tanto, tu cuenta permanecer√° bloqueada.
          </p>
          <div class="waiting-warning">
            Si la informaci√≥n no se subsana, la cuenta ser√° suspendida definitivamente por medidas de seguridad.
          </div>
        </div>
        
        <!-- Estado de eliminaci√≥n -->
        <div id="deletionState" class="waiting-state" aria-live="assertive">
          <div class="spinner" aria-hidden="true"></div>
          <p class="waiting-text">
            <strong>Procesando eliminaci√≥n definitiva.</strong> Estamos devolviendo los fondos al origen y cerrando tu cuenta.
          </p>
          <div class="waiting-warning">
            Una vez finalizado, no ser√° posible revertir esta decisi√≥n ni volver a usar estos datos.
          </div>
        </div>
        
        <!-- Botones principales -->
        <div class="button-stack">
          <button id="btnActivate" class="btn btn--primary" type="button">
            <span>‚úì</span> Activar mi cuenta
          </button>
          <a class="btn btn--secondary" href="mailto:info@remeexvisa.com?subject=Cuenta%20Bloqueada">
            <span>üìß</span> Enviar Email
          </a>
          <button id="btnDelete" class="btn btn--danger" type="button">
            <span>üóë</span> Eliminar mi cuenta
          </button>
        </div>
        
      </div>
    </main>
    
  </div>

  <!-- OVERLAY WIZARD PRINCIPAL -->
  <div id="wizardOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="wizardTitle">
    <div class="overlay-container">
      
      <!-- Header del wizard -->
      <header class="overlay-header">
        <h2 id="wizardTitle" class="overlay-title">Solicitud de Activaci√≥n</h2>
        <p class="overlay-subtitle">Completa los pasos para generar tu solicitud de WhatsApp</p>
        <button class="overlay-close" id="wizardClose" type="button" aria-label="Cerrar">√ó</button>
      </header>

      <!-- Contenido scrolleable -->
      <div class="overlay-content">
        
        <!-- Progress del wizard -->
        <div class="wizard-progress" aria-hidden="true">
          <div class="progress-step is-active" data-step="1"></div>
          <div class="progress-step" data-step="2"></div>
          <div class="progress-step" data-step="3"></div>
        </div>

        <!-- Formulario -->
        <form id="wizardForm" class="form-grid" novalidate>
          
          <!-- PASO 1: Datos personales -->
          <section class="wizard-step is-active" data-step="1">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="nombre">Nombre</label>
                <input id="nombre" name="nombre" type="text" class="form-input" 
                       autocomplete="given-name" required placeholder="Tu nombre" />
              </div>
              <div class="form-group">
                <label class="form-label" for="apellido">Apellido</label>
                <input id="apellido" name="apellido" type="text" class="form-input"
                       autocomplete="family-name" required placeholder="Tu apellido" />
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="cedula">C√©dula de identidad</label>
                <input id="cedula" name="cedula" type="text" class="form-input"
                       inputmode="numeric" required placeholder="V-12345678" />
              </div>
              <div class="form-group">
                <label class="form-label" for="email">Email asociado</label>
                <input id="email" name="email" type="email" class="form-input"
                       autocomplete="email" required placeholder="tu@correo.com" />
              </div>
            </div>
            
            <div class="wizard-navigation">
              <button type="button" class="nav-btn nav-btn--back" id="cancelWizard">Cancelar</button>
              <button type="button" class="nav-btn nav-btn--next" id="nextStep1">Continuar</button>
            </div>
          </section>

          <!-- PASO 2: Informaci√≥n adicional -->
          <section class="wizard-step" data-step="2">
            
            <!-- Raz√≥n por no validar -->
            <div class="form-group">
              <label class="form-label">¬øPor qu√© no has validado tu cuenta?</label>
              <div class="options-grid">
                <label class="option-item">
                  <input type="radio" name="razon" value="Desconfianza" class="option-radio" required />
                  <span class="option-label">Desconfianza</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="razon" value="Falta de tiempo" class="option-radio" />
                  <span class="option-label">Falta de tiempo</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="razon" value="Dificultad t√©cnica" class="option-radio" />
                  <span class="option-label">Dificultad t√©cnica</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="razon" value="No entiendo el proceso" class="option-radio" />
                  <span class="option-label">No entiendo el proceso</span>
                </label>
              </div>
            </div>

            <!-- Titular de fondos -->
            <div class="form-group">
              <label class="form-label">¬øEres el titular de los fondos?</label>
              <div class="options-grid">
                <label class="option-item">
                  <input type="radio" name="titular" value="S√≠, soy el titular" class="option-radio" required />
                  <span class="option-label">S√≠, soy el titular</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="titular" value="No, act√∫o por un familiar" class="option-radio" />
                  <span class="option-label">No, act√∫o por familiar</span>
                </label>
              </div>
            </div>

            <!-- Comprobantes -->
            <div class="form-group">
              <label class="form-label">¬øTienes comprobantes de titularidad?</label>
              <div class="options-grid">
                <label class="option-item">
                  <input type="radio" name="comprobante" value="S√≠, tengo comprobantes" class="option-radio" required />
                  <span class="option-label">S√≠, tengo comprobantes</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="comprobante" value="No tengo" class="option-radio" />
                  <span class="option-label">No tengo</span>
                </label>
              </div>
            </div>

            <!-- Motivo del bloqueo -->
            <div class="form-group">
              <label class="form-label">¬øConoces el motivo del bloqueo?</label>
              <div class="options-grid">
                <label class="option-item">
                  <input type="radio" name="motivo" value="C√©dula deteriorada" class="option-radio" required />
                  <span class="option-label">C√©dula deteriorada</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Datos biom√©tricos" class="option-radio" />
                  <span class="option-label">Datos biom√©tricos</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Datos inconsistentes" class="option-radio" />
                  <span class="option-label">Datos inconsistentes</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Problemas con firma" class="option-radio" />
                  <span class="option-label">Problemas con firma</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Olvid√© la clave" class="option-radio" />
                  <span class="option-label">Olvid√© la clave</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Intentos fallidos" class="option-radio" />
                  <span class="option-label">Intentos fallidos</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Documento vencido" class="option-radio" />
                  <span class="option-label">Documento vencido</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Actividad inusual" class="option-radio" />
                  <span class="option-label">Actividad inusual</span>
                </label>
                <label class="option-item">
                  <input type="radio" name="motivo" value="Selfie no coincide" class="option-radio" />
                  <span class="option-label">Selfie no coincide</span>
                </label>
              </div>
            </div>

            <!-- Descripci√≥n del caso -->
            <div class="form-group">
              <label class="form-label" for="descripcion">Describe tu caso (m√≠nimo 140 caracteres)</label>
              <textarea id="descripcion" name="descripcion" class="form-input form-textarea" 
                        minlength="140" required 
                        placeholder="Ej.: Transfer√≠ desde mi cuenta bancaria y estoy esperando verificaci√≥n..."></textarea>
            </div>
            
            <div class="wizard-navigation">
              <button type="button" class="nav-btn nav-btn--back" id="backStep2">Volver</button>
              <button type="button" class="nav-btn nav-btn--next" id="nextStep2">Continuar</button>
            </div>
          </section>

          <!-- PASO 3: Preview y env√≠o -->
          <section class="wizard-step" data-step="3">
            <div class="form-group">
              <label class="form-label">Revisa tu mensaje de WhatsApp</label>
              <div id="messagePreview" class="message-preview"></div>
              <p class="text-muted" style="font-size: var(--fs-xs); margin-top: var(--space-sm);">
                Si algo falta, vuelve atr√°s y completa la informaci√≥n.
              </p>
            </div>
            
            <div class="wizard-navigation">
              <button type="button" class="nav-btn nav-btn--back" id="backStep3">Volver</button>
              <a id="sendWhatsApp" class="nav-btn nav-btn--next" target="_blank" rel="noopener">
                Enviar WhatsApp
              </a>
            </div>
          </section>
        </form>
        
      </div>
    </div>
  </div>

  <!-- OVERLAY FIRMA DIGITAL -->
  <div id="signatureOverlay" class="overlay signature-overlay" role="dialog" aria-modal="true" aria-labelledby="signatureTitle">
    <div class="overlay-container">
      
      <!-- Header -->
      <header class="overlay-header">
        <h2 id="signatureTitle" class="overlay-title">Subsanar Firma</h2>
        <p class="overlay-subtitle">Dibuja tu firma para verificar tu identidad</p>
        <button class="overlay-close" id="signatureClose" type="button" aria-label="Cerrar">√ó</button>
      </header>

      <!-- Contenido -->
      <div class="overlay-content">
        
        <!-- Gu√≠a -->
        <div class="signature-guidance">
          <h3>Tu firma no coincidi√≥</h3>
          <p>Reg√≠strala de nuevo para intentar validar tu identidad. Coloca el m√≥vil en posici√≥n horizontal, ap√≥yate en una superficie firme y dibuja dentro del recuadro.</p>
          <p>Aseg√∫rate de replicar la firma de tu c√©dula de identidad.</p>
        </div>

        <!-- Pad de firma -->
        <div class="signature-pad-container">
          <div class="signature-canvas-wrapper">
            <canvas id="signaturePad" aria-label="√Årea para firmar" tabindex="0"></canvas>
            <div class="signature-guidelines" aria-hidden="true">
              <div class="signature-line signature-line--top"></div>
              <div class="signature-line signature-line--main"></div>
              <div class="signature-line signature-line--bottom"></div>
            </div>
          </div>
          <div class="signature-hint">
            Puedes usar tu dedo o un stylus. Usa las herramientas si necesitas corregir el trazo.
          </div>
        </div>

        <!-- Controles -->
        <div class="signature-controls">
          <div class="signature-tools">
            <button id="undoSignature" type="button" class="btn btn--ghost" disabled>Deshacer</button>
            <button id="redoSignature" type="button" class="btn btn--ghost" disabled>Rehacer</button>
            <button id="clearSignature" type="button" class="btn btn--ghost" disabled>Limpiar</button>
          </div>
          
          <div class="signature-status" id="signatureStatus">
            Traza tu firma con un movimiento fluido y sin interrupciones.
          </div>
          
          <button id="submitSignature" type="button" class="btn btn--primary" disabled>
            Enviar firma
          </button>
        </div>
        
      </div>
    </div>
  </div>

  <!-- MODAL AN√ÅLISIS DE FIRMA -->
  <div id="signatureAnalysis" class="analysis-modal" role="alertdialog" aria-modal="true" aria-live="assertive">
    <div class="analysis-content">
      <div class="analysis-spinner spinner" id="analysisSpinner" aria-hidden="true"></div>
      <div class="analysis-title" id="analysisTitle">Analizando firma enviada...</div>
      <div class="analysis-detail" id="analysisDetail">
        Iniciando verificaci√≥n biom√©trica y comparaci√≥n de trazos.
      </div>
      <div class="analysis-progress" id="analysisProgressContainer">
        <div class="analysis-progress-bar" id="analysisProgressBar"></div>
      </div>
      <div class="analysis-percentage" id="analysisPercentage">0%</div>
      <div id="analysisResult" class="hidden">
        <p style="margin-bottom: var(--space-md); text-align: left; color: var(--text-muted); font-size: var(--fs-sm);">
          <strong style="color: var(--accent);">Resultado:</strong> Nuestra plataforma detect√≥ discrepancias que impiden validar la coincidencia con tu documento.
        </p>
        <p style="margin-bottom: var(--space-lg); text-align: left; color: var(--text-muted); font-size: var(--fs-sm);">
          Si la coincidencia no se confirma, completa m√©todos alternativos de verificaci√≥n y contacta a soporte.
        </p>
        <div id="analysisActions" class="deletion-actions">
          <button id="retryIdUpload" class="btn btn--ghost" type="button">Recargar c√©dula</button>
          <button id="contactSupport" class="btn btn--primary" type="button">Ir a soporte</button>
        </div>
      </div>
      <button id="analysisCloseBtn" class="btn btn--primary hidden" type="button">
        Entendido
      </button>
    </div>
  </div>

  <!-- MODAL ELIMINACI√ìN DE CUENTA -->
  <div id="deletionOverlay" class="overlay deletion-modal" role="dialog" aria-modal="true" aria-labelledby="deletionTitle">
    <div class="overlay-container">
      <div class="deletion-content">
        <h2 id="deletionTitle" class="deletion-title">Eliminar Cuenta Definitivamente</h2>
        
        <!-- Paso 1 -->
        <div id="deletionStep1" class="deletion-step">
          <p class="deletion-text">
            Si decides eliminarla, cancelaremos la activaci√≥n en curso, devolveremos los fondos al origen y cerraremos tu cuenta de manera definitiva.
          </p>
          <ul style="margin-bottom: var(--space-lg); padding-left: var(--space-lg); color: var(--text-muted); font-size: var(--fs-sm);">
            <li>Devoluci√≥n del saldo a la tarjeta utilizada originalmente</li>
            <li>Reversi√≥n de intercambios pendientes</li>
            <li>Cancelaci√≥n de la relaci√≥n comercial</li>
            <li>Eliminaci√≥n de accesos y datos</li>
          </ul>
          <p class="deletion-text">
            Una vez solicitado, no podremos revisar tu caso ni permitir futuros retiros con estos datos.
          </p>
          <div class="deletion-actions">
            <button class="btn btn--ghost" id="cancelDeletion">Seguir con activaci√≥n</button>
            <button class="btn btn--danger" id="proceedDeletion">Quiero eliminarla</button>
          </div>
        </div>

        <!-- Paso 2 -->
        <div id="deletionStep2" class="deletion-step hidden">
          <p class="deletion-text">
            <strong>Antes de continuar:</strong> eliminar tu cuenta implica cerrarla definitivamente y perder todos los accesos.
          </p>
          <div class="deletion-warning">
            Esta acci√≥n es irreversible. No podr√°s recuperar el saldo, la cuenta ni los servicios asociados una vez confirmes.
          </div>
          <div class="deletion-actions">
            <button class="btn btn--ghost" id="backDeletion">Volver</button>
            <button class="btn btn--danger" id="confirmDeletion">S√≠, eliminar definitivamente</button>
          </div>
        </div>

        <button class="overlay-close" id="deletionClose" type="button" aria-label="Cerrar">√ó</button>
      </div>
    </div>
  </div>

  <!-- NOTIFICACI√ìN DE SUSPENSI√ìN -->
  <div id="suspensionNotice" class="suspension-notice" role="alertdialog" aria-labelledby="suspensionTitle" aria-modal="true">
    <div class="suspension-content">
      <div class="suspension-icon">‚ö†Ô∏è</div>
      <h3 id="suspensionTitle" class="suspension-title">Aviso Importante</h3>
      <p class="suspension-message">
        Tu cuenta se encuentra <strong>bloqueada temporalmente</strong>. Si no corriges esta situaci√≥n, 
        podr√≠a ser <strong>suspendida pr√≥ximamente</strong> para proteger a nuestros usuarios y cumplir 
        con normas KYC.
      </p>
      <div class="suspension-actions">
        <button id="suspensionDismiss" class="btn btn--ghost">Entendido</button>
        <button id="suspensionContinue" class="btn btn--primary">Continuar</button>
      </div>
    </div>
  </div>

  <!-- LOADER GLOBAL -->
  <div id="globalLoader" class="global-loader" aria-live="polite" aria-busy="true">
    <div class="loader-content">
      <div class="loader-spinner spinner" aria-hidden="true"></div>
      <div class="loader-message" id="loaderMessage">Analizando tu solicitud...</div>
      <div class="loader-subtitle">Esto puede tardar unos segundos</div>
    </div>
  </div>

  <!-- LOADER ELIMINACI√ìN -->
  <div id="deletionLoader" class="global-loader" aria-live="assertive" aria-busy="true">
    <div class="loader-content">
      <div class="loader-spinner spinner" aria-hidden="true"></div>
      <div class="loader-message" id="deletionMessage">Preparando eliminaci√≥n...</div>
      <div class="loader-subtitle">Por favor, no cierres esta ventana</div>
    </div>
  </div>

  <!-- JAVASCRIPT -->
  <script>
    // === CONFIGURACI√ìN GLOBAL ===
    const CONFIG = {
      phoneNumber: '17373018059',
      storageKey: 'remeexAccountClosed',
      analysisTimeout: 300000, // 5 minutos
      deletionSteps: [
        'Liberando fondos hacia el medio original...',
        'Revirtiendo intercambios pendientes...',
        'Eliminando credenciales asociadas...',
        'Confirmando eliminaci√≥n definitiva...'
      ]
    };

    // === UTILIDADES ===
    const $ = (selector) => document.querySelector(selector);
    const $$ = (selector) => Array.from(document.querySelectorAll(selector));

    // Verificar cuenta cerrada
    (function checkClosedAccount() {
      try {
        if (localStorage.getItem(CONFIG.storageKey)) {
          window.location.replace('https://visa.es');
          return;
        }
      } catch(e) {}
    })();

    // === GESTI√ìN DE VIEWPORT EN M√ìVIL ===
    function setViewportHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    window.addEventListener('resize', setViewportHeight);
    window.addEventListener('orientationchange', setViewportHeight);
    setViewportHeight();

    // === GESTI√ìN DE SALDOS ===
    class BalanceManager {
      constructor() {
        this.bsElement = $('#saldoBs');
        this.usdElement = $('#saldoUsd');
        this.initFromParams();
      }

      initFromParams() {
        const params = new URLSearchParams(window.location.search);
        const bsParam = params.get('saldo_bs') || params.get('saldoBs') || '0';
        const usdParam = params.get('saldo_usd') || params.get('saldoUsd') || '0';
        
        this.bsValue = this.parseAmount(bsParam);
        this.usdValue = this.parseAmount(usdParam);
        
        this.updateDisplay();
      }

      parseAmount(raw) {
        if (!raw) return 0;
        const cleaned = raw.toString().replace(/[^0-9.,-]/g, '');
        const normalized = cleaned.replace(/[,]/g, '.');
        return parseFloat(normalized) || 0;
      }

      formatAmount(value, currency) {
        const formatters = {
          'VES': new Intl.NumberFormat('es-VE', { style: 'currency', currency: 'VES' }),
          'USD': new Intl.NumberFormat('es-US', { style: 'currency', currency: 'USD' })
        };
        
        try {
          return formatters[currency].format(value);
        } catch(e) {
          return currency === 'VES' ? `Bs. ${value.toFixed(2)}` : `$${value.toFixed(2)}`;
        }
      }

      updateDisplay() {
        if (this.bsElement) {
          this.bsElement.textContent = this.formatAmount(this.bsValue, 'VES');
        }
        if (this.usdElement) {
          this.usdElement.textContent = this.formatAmount(this.usdValue, 'USD');
        }
      }

      async animateToZero() {
        return new Promise(resolve => {
          const duration = 2400;
          const startTime = performance.now();
          const initialBs = this.bsValue;
          const initialUsd = this.usdValue;

          const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            this.bsValue = Math.max(initialBs * (1 - progress), 0);
            this.usdValue = Math.max(initialUsd * (1 - progress), 0);
            this.updateDisplay();

            if (progress < 1) {
              requestAnimationFrame(animate);
            } else {
              this.bsValue = 0;
              this.usdValue = 0;
              this.updateDisplay();
              resolve();
            }
          };

          requestAnimationFrame(animate);
        });
      }
    }

    // === GESTI√ìN DE OVERLAYS ===
    class OverlayManager {
      constructor() {
        this.overlays = new Map();
        this.stack = [];
        this.setupEventListeners();
      }

      register(id, element) {
        this.overlays.set(id, element);
      }

      show(id, options = {}) {
        const overlay = this.overlays.get(id);
        if (!overlay) return false;

        // Cerrar overlay actual si existe
        if (this.stack.length > 0) {
          const current = this.stack[this.stack.length - 1];
          this.overlays.get(current)?.classList.remove('is-visible');
        }

        overlay.classList.add('is-visible');
        this.stack.push(id);

        // Resetear scroll
        const content = overlay.querySelector('.overlay-content');
        if (content) content.scrollTop = 0;

        // Focus management
        if (options.focusElement) {
          setTimeout(() => {
            const element = overlay.querySelector(options.focusElement);
            element?.focus({ preventScroll: true });
          }, 100);
        }

        // Prevenir scroll del body
        document.body.style.overflow = 'hidden';

        return true;
      }

      hide(id) {
        const overlay = this.overlays.get(id);
        if (!overlay) return false;

        overlay.classList.remove('is-visible');
        
        const index = this.stack.indexOf(id);
        if (index > -1) {
          this.stack.splice(index, 1);
        }

        // Mostrar overlay anterior si existe
        if (this.stack.length > 0) {
          const previous = this.stack[this.stack.length - 1];
          this.overlays.get(previous)?.classList.add('is-visible');
        } else {
          // Restaurar scroll del body
          document.body.style.overflow = '';
        }

        return true;
      }

      hideAll() {
        this.stack.forEach(id => {
          this.overlays.get(id)?.classList.remove('is-visible');
        });
        this.stack = [];
        document.body.style.overflow = '';
      }

      setupEventListeners() {
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && this.stack.length > 0) {
            const current = this.stack[this.stack.length - 1];
            this.hide(current);
          }
        });
      }
    }

    // === SISTEMA WIZARD ===
    class WizardManager {
      constructor() {
        this.currentStep = 1;
        this.totalSteps = 3;
        this.form = $('#wizardForm');
        this.setupEventListeners();
      }

      setStep(step) {
        if (step < 1 || step > this.totalSteps) return false;

        // Actualizar pasos
        $$('.wizard-step').forEach(el => {
          const stepNum = parseInt(el.dataset.step);
          el.classList.toggle('is-active', stepNum === step);
        });

        // Actualizar progress
        $$('.progress-step').forEach(el => {
          const stepNum = parseInt(el.dataset.step);
          el.classList.toggle('is-active', stepNum === step);
          el.classList.toggle('is-completed', stepNum < step);
        });

        this.currentStep = step;
        return true;
      }

      validateStep1() {
        const fields = ['nombre', 'apellido', 'cedula', 'email'];
        let valid = true;

        fields.forEach(field => {
          const input = $(`#${field}`);
          if (!input) return;

          const value = input.value.trim();
          const isEmail = field === 'email';
          const emailValid = isEmail ? /^\S+@\S+\.\S+$/.test(value) : true;
          
          if (!value || (isEmail && !emailValid)) {
            input.style.borderColor = '#f87171';
            valid = false;
          } else {
            input.style.borderColor = 'rgba(255,255,255,0.2)';
          }
        });

        return valid;
      }

      validateStep2() {
        const required = ['razon', 'titular', 'comprobante', 'motivo'];
        const description = $('#descripcion');
        
        let valid = true;

        // Validar radios
        required.forEach(name => {
          const selected = this.form.querySelector(`input[name="${name}"]:checked`);
          if (!selected) valid = false;
        });

        // Validar descripci√≥n
        if (description) {
          const text = description.value.trim();
          if (text.length < 140) {
            description.style.borderColor = '#f87171';
            valid = false;
          } else {
            description.style.borderColor = 'rgba(255,255,255,0.2)';
          }
        }

        return valid;
      }

      composeMessage() {
        const data = new FormData(this.form);
        const nombre = data.get('nombre') || '';
        const apellido = data.get('apellido') || '';
        const cedula = data.get('cedula') || '';
        const email = data.get('email') || '';
        const razon = data.get('razon') || '';
        const titular = data.get('titular') || '';
        const comprobante = data.get('comprobante') || '';
        const motivo = data.get('motivo') || '';
        const descripcion = data.get('descripcion') || '';

        return [
          'Hola, buen d√≠a. Solicito *activaci√≥n de cuenta* en Remeex Visa.',
          '',
          '*Datos del cliente*:',
          `‚Ä¢ Nombre: ${nombre} ${apellido}`,
          `‚Ä¢ C√©dula: ${cedula}`,
          `‚Ä¢ Email: ${email}`,
          '',
          `*Motivo por el que no valid√©*: ${razon}`,
          `*Motivo del bloqueo*: ${motivo}`,
          `*Titular de fondos*: ${titular}`,
          `*Comprobantes*: ${comprobante}`,
          '',
          `*Descripci√≥n del caso*: ${descripcion}`,
          '',
          'Agradezco indicaciones para completar la validaci√≥n. ¬°Gracias!'
        ].join('\n');
      }

      updatePreview() {
        const preview = $('#messagePreview');
        if (preview) {
          preview.textContent = this.composeMessage();
        }

        const link = $('#sendWhatsApp');
        if (link) {
          const message = encodeURIComponent(this.composeMessage());
          link.href = `https://wa.me/${CONFIG.phoneNumber}?text=${message}`;
        }
      }

      setupEventListeners() {
        // Navegaci√≥n
        $('#nextStep1')?.addEventListener('click', () => {
          if (this.validateStep1()) {
            this.setStep(2);
            this.focusFirstRadio();
          }
        });

        $('#nextStep2')?.addEventListener('click', () => {
          if (this.validateStep2()) {
            overlayManager.show('globalLoader');
            setTimeout(() => {
              overlayManager.hide('globalLoader');
              this.setStep(3);
              this.updatePreview();
              suspensionManager.showOnce();
            }, 1200);
          }
        });

        $('#backStep2')?.addEventListener('click', () => this.setStep(1));
        $('#backStep3')?.addEventListener('click', () => this.setStep(2));

        // Actualizar preview en tiempo real
        this.form?.addEventListener('input', () => {
          if (this.currentStep === 3) {
            this.updatePreview();
          }
        });

        // Detectar firma en motivo
        $$('input[name="motivo"]').forEach(radio => {
          radio.addEventListener('change', (e) => {
            const value = e.target.value.toLowerCase();
            if (value.includes('firma')) {
              overlayManager.hide('wizardOverlay');
              overlayManager.show('signatureOverlay');
            }
          });
        });

        // WhatsApp enviado
        $('#sendWhatsApp')?.addEventListener('click', () => {
          stateManager.setWaiting();
          overlayManager.hide('wizardOverlay');
        });
      }

      focusFirstRadio() {
        setTimeout(() => {
          const firstRadio = this.form.querySelector('input[name="razon"]');
          firstRadio?.focus({ preventScroll: true });
        }, 100);
      }
    }

    // === GESTI√ìN DE ESTADOS ===
    class StateManager {
      constructor() {
        this.isWaiting = false;
        this.isDeleting = false;
      }

      setWaiting() {
        if (this.isWaiting) return;
        
        this.isWaiting = true;
        const fullName = this.getFullName();
        
        const userElement = $('#waitingUser');
        if (userElement) userElement.textContent = fullName;

        document.body.classList.add('is-waiting');
        $('#waitingState')?.classList.add('is-active');
      }

      setDeleting() {
        if (this.isDeleting) return;

        this.isDeleting = true;
        document.body.classList.add('is-deleting');
        $('#deletionState')?.classList.add('is-active');

        const description = $('#mainDescription');
        if (description) {
          description.textContent = 'Has decidido eliminar tu cuenta. Estamos devolviendo los fondos y cerr√°ndola de forma definitiva.';
        }

        this.disableButtons();
      }

      getFullName() {
        const nombre = $('#nombre')?.value?.trim() || '';
        const apellido = $('#apellido')?.value?.trim() || '';
        return `${nombre} ${apellido}`.trim() || 'el titular';
      }

      disableButtons() {
        $$('.btn').forEach(btn => {
          btn.disabled = true;
          btn.style.opacity = '0.3';
          btn.style.pointerEvents = 'none';
        });
      }
    }

    // === GESTI√ìN DE FIRMA DIGITAL ===
    class SignatureManager {
      constructor() {
        this.canvas = $('#signaturePad');
        this.ctx = null;
        this.isDrawing = false;
        this.strokes = [];
        this.undoStack = [];
        this.currentStroke = [];
        this.scale = 1;
        this.hasContent = false;

        this.setupCanvas();
        this.setupEventListeners();
      }

      setupCanvas() {
        if (!this.canvas) return;

        this.resizeCanvas();
        this.ctx = this.canvas.getContext('2d');
        
        if (this.ctx) {
          this.ctx.lineCap = 'round';
          this.ctx.lineJoin = 'round';
          this.ctx.strokeStyle = '#F7B600';
          this.ctx.lineWidth = 2;
        }
      }

      resizeCanvas() {
        if (!this.canvas) return;

        const rect = this.canvas.getBoundingClientRect();
        const dpr = window.devicePixelRatio || 1;

        this.canvas.width = rect.width * dpr;
        this.canvas.height = rect.height * dpr;
        this.scale = dpr;

        if (this.ctx) {
          this.ctx.scale(dpr, dpr);
        }

        this.redraw();
      }

      getEventPos(e) {
        const rect = this.canvas.getBoundingClientRect();
        return {
          x: (e.clientX || e.touches?.[0]?.clientX || 0) - rect.left,
          y: (e.clientY || e.touches?.[0]?.clientY || 0) - rect.top
        };
      }

      startDrawing(e) {
        e.preventDefault();
        if (!this.ctx) return;

        this.isDrawing = true;
        this.currentStroke = [];
        this.undoStack = []; // Clear redo stack

        const pos = this.getEventPos(e);
        this.currentStroke.push(pos);
        
        this.ctx.beginPath();
        this.ctx.moveTo(pos.x, pos.y);
      }

      draw(e) {
        if (!this.isDrawing || !this.ctx) return;
        e.preventDefault();

        const pos = this.getEventPos(e);
        this.currentStroke.push(pos);
        
        this.ctx.lineTo(pos.x, pos.y);
        this.ctx.stroke();
      }

      stopDrawing(e) {
        if (!this.isDrawing) return;
        e.preventDefault();

        this.isDrawing = false;
        
        if (this.currentStroke.length > 1) {
          this.strokes.push([...this.currentStroke]);
          this.hasContent = true;
        }
        
        this.currentStroke = [];
        this.updateButtons();
        this.updateStatus('Firma capturada. Revisa el trazo antes de enviar.', 'success');
      }

      clear() {
        if (!this.ctx) return;

        this.ctx.clearRect(0, 0, this.canvas.width / this.scale, this.canvas.height / this.scale);
        this.strokes = [];
        this.undoStack = [];
        this.hasContent = false;
        this.updateButtons();
        this.updateStatus('El lienzo est√° vac√≠o. Traza tu firma para continuar.', '');
      }

      undo() {
        if (this.strokes.length === 0) return;

        const lastStroke = this.strokes.pop();
        this.undoStack.push(lastStroke);
        this.hasContent = this.strokes.length > 0;
        this.redraw();
        this.updateButtons();
        
        if (this.hasContent) {
          this.updateStatus('√öltimo trazo deshecho. Contin√∫a o env√≠a la captura.', 'success');
        } else {
          this.updateStatus('No quedan trazos. Dibuja de nuevo tu firma.', 'warning');
        }
      }

      redo() {
        if (this.undoStack.length === 0) return;

        const stroke = this.undoStack.pop();
        this.strokes.push(stroke);
        this.hasContent = true;
        this.redraw();
        this.updateButtons();
        this.updateStatus('Trazo restaurado correctamente.', 'success');
      }

      redraw() {
        if (!this.ctx) return;

        this.ctx.clearRect(0, 0, this.canvas.width / this.scale, this.canvas.height / this.scale);
        
        this.strokes.forEach(stroke => {
          if (stroke.length < 2) return;
          
          this.ctx.beginPath();
          this.ctx.moveTo(stroke[0].x, stroke[0].y);
          
          for (let i = 1; i < stroke.length; i++) {
            this.ctx.lineTo(stroke[i].x, stroke[i].y);
          }
          
          this.ctx.stroke();
        });
      }

      updateButtons() {
        const undoBtn = $('#undoSignature');
        const redoBtn = $('#redoSignature');
        const clearBtn = $('#clearSignature');
        const submitBtn = $('#submitSignature');

        if (undoBtn) undoBtn.disabled = this.strokes.length === 0;
        if (redoBtn) redoBtn.disabled = this.undoStack.length === 0;
        if (clearBtn) clearBtn.disabled = !this.hasContent;
        if (submitBtn) submitBtn.disabled = !this.hasContent;
      }

      updateStatus(message, type = '') {
        const status = $('#signatureStatus');
        if (!status) return;

        status.textContent = message;
        status.className = 'signature-status';
        if (type) status.classList.add(`signature-status--${type}`);
      }

      setupEventListeners() {
        if (!this.canvas) return;

        // Mouse events
        this.canvas.addEventListener('mousedown', (e) => this.startDrawing(e));
        this.canvas.addEventListener('mousemove', (e) => this.draw(e));
        this.canvas.addEventListener('mouseup', (e) => this.stopDrawing(e));
        this.canvas.addEventListener('mouseleave', (e) => this.stopDrawing(e));

        // Touch events
        this.canvas.addEventListener('touchstart', (e) => this.startDrawing(e));
        this.canvas.addEventListener('touchmove', (e) => this.draw(e));
        this.canvas.addEventListener('touchend', (e) => this.stopDrawing(e));
        this.canvas.addEventListener('touchcancel', (e) => this.stopDrawing(e));

        // Prevent scrolling when touching the canvas
        this.canvas.addEventListener('touchstart', (e) => e.preventDefault());
        this.canvas.addEventListener('touchend', (e) => e.preventDefault());
        this.canvas.addEventListener('touchmove', (e) => e.preventDefault());

        // Keyboard
        this.canvas.addEventListener('keydown', (e) => {
          if ((e.key === 'z' || e.key === 'Z') && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            if (e.shiftKey) {
              this.redo();
            } else {
              this.undo();
            }
          } else if (e.key === 'Delete' || e.key === 'Backspace') {
            e.preventDefault();
            this.clear();
          }
        });

        // Button events
        $('#undoSignature')?.addEventListener('click', () => this.undo());
        $('#redoSignature')?.addEventListener('click', () => this.redo());
        $('#clearSignature')?.addEventListener('click', () => this.clear());
        
        $('#submitSignature')?.addEventListener('click', () => {
          if (!this.hasContent) {
            this.updateStatus('Debes trazar tu firma antes de enviarla.', 'warning');
            return;
          }
          analysisManager.start();
        });

        // Resize handler
        window.addEventListener('resize', () => this.resizeCanvas());
        window.addEventListener('orientationchange', () => {
          setTimeout(() => this.resizeCanvas(), 200);
        });
      }
    }

    // === AN√ÅLISIS DE FIRMA ===
    class AnalysisManager {
      constructor() {
        this.isRunning = false;
        this.progress = 0;
        this.timers = [];
      }

      start() {
        if (this.isRunning) return;

        this.isRunning = true;
        overlayManager.hide('signatureOverlay');
        overlayManager.show('signatureAnalysis');
        
        this.resetUI();
        this.runAnalysis();
      }

      resetUI() {
        $('#analysisSpinner')?.classList.remove('hidden');
        $('#analysisResult')?.classList.add('hidden');
        $('#analysisActions')?.classList.add('hidden');
        $('#analysisCloseBtn')?.classList.add('hidden');
        
        const title = $('#analysisTitle');
        const detail = $('#analysisDetail');
        const percentage = $('#analysisPercentage');
        
        if (title) title.textContent = 'Analizando firma enviada...';
        if (detail) detail.textContent = 'Iniciando verificaci√≥n biom√©trica y comparaci√≥n de trazos.';
        if (percentage) percentage.textContent = '0%';
        
        this.setProgress(0);
      }

      runAnalysis() {
        const steps = [
          { time: 0, text: 'Iniciando verificaci√≥n biom√©trica y comparaci√≥n de trazos.' },
          { time: 60000, text: 'Contrastando vectores con base de datos del titular.' },
          { time: 120000, text: 'Evaluando presi√≥n, velocidad y puntos de inflexi√≥n.' },
          { time: 180000, text: 'Comparando coincidencia angular con firma registrada.' },
          { time: 240000, text: 'Aplicando filtros antifraude y heur√≠sticas.' }
        ];

        // Actualizar progreso
        const progressTimer = setInterval(() => {
          this.progress += 0.5;
          this.setProgress(this.progress);
          
          if (this.progress >= 100) {
            clearInterval(progressTimer);
          }
        }, 1500);

        this.timers.push(progressTimer);

        // Actualizar textos
        steps.forEach(step => {
          const timer = setTimeout(() => {
            if (this.isRunning) {
              const detail = $('#analysisDetail');
              if (detail) detail.textContent = step.text;
            }
          }, step.time);
          
          this.timers.push(timer);
        });

        // Finalizar an√°lisis
        const finishTimer = setTimeout(() => {
          this.finish();
        }, CONFIG.analysisTimeout);
        
        this.timers.push(finishTimer);
      }

      setProgress(value) {
        const clamped = Math.max(0, Math.min(100, value));
        const bar = $('#analysisProgressBar');
        const text = $('#analysisPercentage');
        
        if (bar) bar.style.width = `${clamped}%`;
        if (text) text.textContent = `${Math.round(clamped)}%`;
      }

      finish() {
        this.cleanup();
        
        const spinner = $('#analysisSpinner');
        const title = $('#analysisTitle');
        const detail = $('#analysisDetail');
        const result = $('#analysisResult');
        const actions = $('#analysisActions');
        const closeBtn = $('#analysisCloseBtn');
        
        if (spinner) spinner.classList.add('hidden');
        if (title) title.textContent = 'No pudimos confirmar tu firma digital';
        if (detail) detail.textContent = 'El an√°lisis detect√≥ variaciones respecto al documento registrado.';
        if (result) result.classList.remove('hidden');
        if (actions) actions.classList.remove('hidden');
        if (closeBtn) closeBtn.classList.remove('hidden');

        this.setProgress(100);
      }

      cleanup() {
        this.isRunning = false;
        this.progress = 0;
        
        this.timers.forEach(timer => clearTimeout(timer));
        this.timers = [];
      }
    }

    // === GESTI√ìN DE ELIMINACI√ìN ===
    class DeletionManager {
      constructor() {
        this.step = 1;
        this.isProcessing = false;
        this.timers = [];
      }

      showModal() {
        this.setStep(1);
        overlayManager.show('deletionOverlay', { focusElement: '#proceedDeletion' });
      }

      setStep(step) {
        this.step = step;
        $('#deletionStep1')?.classList.toggle('hidden', step !== 1);
        $('#deletionStep2')?.classList.toggle('hidden', step !== 2);
      }

      async startDeletion() {
        if (this.isProcessing) return;

        this.isProcessing = true;
        overlayManager.hide('deletionOverlay');
        overlayManager.show('deletionLoader');
        
        stateManager.setDeleting();
        
        // Animar saldos a cero
        await balanceManager.animateToZero();
        
        // Proceso de eliminaci√≥n
        this.runDeletionProcess();
      }

      runDeletionProcess() {
        let stepIndex = 0;
        
        const processStep = () => {
          if (stepIndex >= CONFIG.deletionSteps.length) {
            this.completeDeletion();
            return;
          }
          
          const message = $('#deletionMessage');
          if (message) message.textContent = CONFIG.deletionSteps[stepIndex];
          
          stepIndex++;
          const timer = setTimeout(processStep, 2000);
          this.timers.push(timer);
        };
        
        processStep();
      }

      async completeDeletion() {
        this.cleanup();
        
        const message = $('#deletionMessage');
        if (message) message.textContent = 'Cuenta eliminada. Finalizando sesi√≥n...';
        
        // Limpiar datos
        await this.clearUserData();
        
        // Marcar cuenta cerrada
        try {
          localStorage.setItem(CONFIG.storageKey, 'true');
        } catch(e) {}
        
        setTimeout(() => {
          this.showFinalScreen();
          setTimeout(() => {
            window.location.replace('https://visa.es');
          }, 1500);
        }, 800);
      }

      async clearUserData() {
        try {
          localStorage.clear();
          sessionStorage.clear();
          
          if ('caches' in window) {
            const cacheNames = await caches.keys();
            await Promise.all(cacheNames.map(name => caches.delete(name)));
          }
          
          if ('serviceWorker' in navigator) {
            const registrations = await navigator.serviceWorker.getRegistrations();
            await Promise.all(registrations.map(reg => reg.unregister()));
          }
          
        } catch(e) {}
      }

      showFinalScreen() {
        try {
          document.body.innerHTML = `
            <div style="position:fixed;inset:0;background:rgba(255,255,255,0.9);
                        backdrop-filter:blur(12px);display:flex;align-items:center;
                        justify-content:center;font-family:system-ui,sans-serif;
                        color:#1A1F71;font-size:18px;text-align:center;padding:24px;">
              Cuenta eliminada definitivamente. Redirigiendo...
            </div>
          `;
        } catch(e) {}
      }

      cleanup() {
        this.isProcessing = false;
        this.timers.forEach(timer => clearTimeout(timer));
        this.timers = [];
      }
    }

    // === NOTIFICACI√ìN DE SUSPENSI√ìN ===
    class SuspensionManager {
      constructor() {
        this.hasShown = false;
      }

      showOnce() {
        if (this.hasShown) return;
        
        this.hasShown = true;
        setTimeout(() => {
          overlayManager.show('suspensionNotice');
        }, 500);
      }

      hide() {
        overlayManager.hide('suspensionNotice');
      }
    }

    // === INICIALIZACI√ìN ===
    const balanceManager = new BalanceManager();
    const overlayManager = new OverlayManager();
    const wizardManager = new WizardManager();
    const stateManager = new StateManager();
    const signatureManager = new SignatureManager();
    const analysisManager = new AnalysisManager();
    const deletionManager = new DeletionManager();
    const suspensionManager = new SuspensionManager();

    // Registrar overlays
    overlayManager.register('wizardOverlay', $('#wizardOverlay'));
    overlayManager.register('signatureOverlay', $('#signatureOverlay'));
    overlayManager.register('signatureAnalysis', $('#signatureAnalysis'));
    overlayManager.register('deletionOverlay', $('#deletionOverlay'));
    overlayManager.register('suspensionNotice', $('#suspensionNotice'));
    overlayManager.register('globalLoader', $('#globalLoader'));
    overlayManager.register('deletionLoader', $('#deletionLoader'));

    // === EVENT LISTENERS PRINCIPALES ===
    
    // Bot√≥n activar cuenta
    $('#btnActivate')?.addEventListener('click', () => {
      overlayManager.show('wizardOverlay', { focusElement: '#nombre' });
    });

    // Bot√≥n eliminar cuenta
    $('#btnDelete')?.addEventListener('click', () => {
      deletionManager.showModal();
    });

    // Cerrar wizard
    $$('#wizardClose, #cancelWizard').forEach(btn => {
      btn?.addEventListener('click', () => {
        overlayManager.hide('wizardOverlay');
      });
    });

    // Cerrar firma
    $('#signatureClose')?.addEventListener('click', () => {
      overlayManager.hide('signatureOverlay');
    });

    // Gesti√≥n eliminaci√≥n
    $('#cancelDeletion')?.addEventListener('click', () => {
      overlayManager.hide('deletionOverlay');
    });

    $('#proceedDeletion')?.addEventListener('click', () => {
      deletionManager.setStep(2);
    });

    $('#backDeletion')?.addEventListener('click', () => {
      deletionManager.setStep(1);
    });

    $('#confirmDeletion')?.addEventListener('click', () => {
      deletionManager.startDeletion();
    });

    $('#deletionClose')?.addEventListener('click', () => {
      overlayManager.hide('deletionOverlay');
    });

    // An√°lisis de firma
    $('#retryIdUpload')?.addEventListener('click', () => {
      overlayManager.hide('signatureAnalysis');
      analysisManager.cleanup();
      overlayManager.show('wizardOverlay');
      wizardManager.setStep(1);
    });

    $('#contactSupport')?.addEventListener('click', () => {
      const supportMsg = 'Hola, necesito asistencia con la verificaci√≥n de mi firma. El sistema indic√≥ que no coincide con mi c√©dula.';
      const supportUrl = `https://wa.me/${CONFIG.phoneNumber}?text=${encodeURIComponent(supportMsg)}`;
      window.open(supportUrl, '_blank', 'noopener,noreferrer');
      overlayManager.hide('signatureAnalysis');
      analysisManager.cleanup();
    });

    $('#analysisCloseBtn')?.addEventListener('click', () => {
      overlayManager.hide('signatureAnalysis');
      analysisManager.cleanup();
    });

    // Notificaci√≥n suspensi√≥n
    $$('#suspensionDismiss, #suspensionContinue').forEach(btn => {
      btn?.addEventListener('click', () => {
        suspensionManager.hide();
      });
    });

    // === PREVENCI√ìN DE ZOOM EN IOS ===
    document.addEventListener('touchstart', function(e) {
      if (e.touches.length > 1) {
        e.preventDefault();
      }
    }, { passive: false });

    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        e.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // === OPTIMIZACI√ìN DE RENDIMIENTO ===
    
    // Lazy loading de im√°genes
    if ('IntersectionObserver' in window) {
      const imageObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              imageObserver.unobserve(img);
            }
          }
        });
      });

      $$('img[data-src]').forEach(img => imageObserver.observe(img));
    }

    // Service Worker para cache (opcional)
    if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
      navigator.serviceWorker.register('/sw.js').catch(() => {});
    }

    // === DEBUG (solo en desarrollo) ===
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
      window.remeexDebug = {
        balanceManager,
        overlayManager,
        wizardManager,
        stateManager,
        signatureManager,
        analysisManager,
        deletionManager,
        suspensionManager
      };
    }

    // === CLEANUP AL CERRAR P√ÅGINA ===
    window.addEventListener('beforeunload', () => {
      analysisManager.cleanup();
      deletionManager.cleanup();
    });

    console.log('üéØ Remeex Visa Mobile App iniciada correctamente');

  </script>

  <!-- Tawk.to (Chat de soporte) -->
  <script>
    var Tawk_API = Tawk_API || {};
    var Tawk_LoadStart = new Date();
    (function(){
      var s1 = document.createElement("script");
      var s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = 'https://embed.tawk.to/68a44855d541a4192285c373/1j30rl42b';
      s1.charset = 'UTF-8';
      s1.setAttribute('crossorigin','*');
      s0.parentNode.insertBefore(s1,s0);
    })();
  </script>

</body>
</html>
